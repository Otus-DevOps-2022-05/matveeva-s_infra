# matveeva-s_infra

# Выполнено ДЗ №6

 - [x] Основное ДЗ

## В процессе сделано:
- Установлен terraform
- Создан конфигурационный файл main.tf для терраформа для работы с YC (на базе образа из прошлой ДЗ)
- Создан сервисный аккаунт для терраформа, и ему предоставлен доступ (однако почему-то этого не хватило, и при выносе переменных в отдельный файл я вынесла в итоге токен, а не путь до key.json)
- Добавлены провиженеры для автоматического деплоя тестового приложение после создания ресурса
- Добавлен отдельный файл variables.tf с переменными окружения и их описаниями
- Чувствительные данные (токен, идентификаторы, пути до ssh ключей), описанные в variables.tf, вынесены в отдельный файл terraform.tfvars
- Тестовое приложение reddit-app автоматически деплоится после `terraform apply`

# Выполнено ДЗ №5

 - [x] Основное ДЗ: сборка с помощью Packer, с последующей заменой чувствительных данных

## В процессе сделано:
- Установлен (через боль и страдания) packer
- Создан сервисный акк, которому добавлены доступы к созданному ранее каталогу infra
- Создан конфигурационный файл-шаблон ubuntu16.json для пакера, куда добавлены необходимые билдеры и provisioners
- Создан образ
- На базе этого образа ручками создана ВМ, на которой задеплоено тестовое приложение reddit-app


# Выполнено ДЗ №4

 - [x] Основное ДЗ
 - [] Задание со *

## В процессе сделано:
 - Через yandex CLI развернута виртуалка `reddit-app`
 - На виртуалку были поставлены Ruby,  Ruby Bundler, MongoDB
 - Был склонирован репозиторий с тестовым приложением
 - Тестовое приложение было запущено на порту 9292
 - В качестве проверки был отправлен тестовый пост
 - Установки пакетов и запуск приложения были разделены на 3 скрипта, которые были помечены исполняемыми файлами

## IP-адрес виртуалки и порт:
testapp_IP = 62.84.125.97
testapp_port = 9292

# Выполнено ДЗ №3

 - [x] Основное ДЗ
 - [x] Допзадание с варинатом подключения к `someinternalhost`
 - [ ] Допзадание с ssl сертификатом для виртуалки с бастионом

## В процессе сделано:
 - Созданы 2 виртуальные машины (`bastion` и `someinternalhost`) в Yandex Cloud
 - Создана пара ssh-ключей для доступа к этим виртуалкам
 - Проверено подключение к `someinternalhost` через `bastion` (ниже будет про способ хождение напрямую)
 - На виртуалку `bastion` после долгих мучений установлена mongo
 - Запущен VPN сервис, проведена регистрация тестовго клиента и огранизации
 - Проверена работоспособность VPN, проверено хождение в `someinternalhost` напрямую со включенным ВПН

## IP-адреса виртуалок:
bastion_IP = 51.250.94.221
someinternalhost_IP = 10.128.0.34

## Допзадание с подключением к `someinternalhost`

Как вариант, вынести `bastion` и `someinternalhost` в `.ssh/config` своего рабочего пространство, и указать `bastion` как ProxyJump для прохода на `someinternalhost`. У меня это выглядит так:

```
Host bastion
  HostName 51.250.74.84
  User s-matveeva
  IdentityFile ~/.ssh/yandex_cloud/yandex_cloud_key
Host someinternalhost
  Hostname 10.128.0.34
  User s-matveeva
  IdentityFile ~/.ssh/yandex_cloud/yandex_cloud_key
  ProxyJump bastion
```
